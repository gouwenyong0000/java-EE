[传送门]: https://www.bilibili.com/video/BV1j54y1b7qv

# 多用户即时通信系统

# 需求分析

1，用户登录
2，拉取在线用户列表
3，无异常退出（客户端、服务端）
4，私聊5，群聊
6，发文件
7，服务器推送新闻



![image-20210617203601978](多用户通信系统.assets/image-20210617203601978.png)

![image-20210617203608663](多用户通信系统.assets/image-20210617203608663.png)

![image-20210617203649715](多用户通信系统.assets/image-20210617203649715.png)

![image-20210617204150210](多用户通信系统.assets/image-20210617204150210.png)

![image-20210617204140915](多用户通信系统.assets/image-20210617204140915.png)

![image-20210617204159820](多用户通信系统.assets/image-20210617204159820.png)

# 需求实现

## 原理图

![image-20210620225038697](多用户通信系统.assets/image-20210620225038697.png)



原理分析：

1. 服务器和客户端连接后，都启动一个线程循环读取Message对象【发送者、内容、消息类型等】

2. 客户端/服务器需要进行回复是，通过在相应的管理线程中获取线程，从线程中获取socket，得到输出流，在用对象流包裹一层，将交互的message对象传输，客户端/服务器都有线程在循环的读取，对消息进行处理

## 用户登陆

![image-20210617204451030](多用户通信系统.assets/image-20210617204451030.png)



## 拉取用户列表



客户端发送message消息给服务器

通过客户端保持与服务器连接的socket的线程





## 无异常退出

![image-20210621222421901](多用户通信系统.assets/image-20210621222421901.png)



## 私聊实现

![image-20210621233843671](多用户通信系统.assets/image-20210621233843671.png)



## 群聊

参考私聊，服务器转发到多人





## 发送文件

![image-20210622012109279](多用户通信系统.assets/image-20210622012109279.png)

![image-20210622012806463](多用户通信系统.assets/image-20210622012806463.png)





## 推送新闻

![image-20210623001602172](多用户通信系统.assets/image-20210623001602172.png)



## 离线消息

![image-20210623002034372](多用户通信系统.assets/image-20210623002034372.png)